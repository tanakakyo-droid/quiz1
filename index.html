<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>英検準一級単語クイズ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #quiz, #result { display: none; }
  </style>
</head>
<body>
  <h1>英検準一級単語クイズ</h1>
  <div id="start">
    <button onclick="startQuiz()">スタート</button>
  </div>
  <div id="quiz"></div>
  <div id="result"></div>

  <script>
    const quizData = [
      { q: "liberate の意味は？", a: "解放する", choices:["攻撃する","解放する","破壊する","避ける"] },
      { q: "perilous の意味は？", a: "危険な", choices:["安全な","危険な","静かな","簡単な"] }
      // …本来の問題が入る
    ];

    let currentIndex = 0;
    let score = 0;
    let startTime;
    let wrongListArray = [];
    let currentUserId = "12345";       // ← ユーザーIDを入れる仕組みに置き換え
    let currentUserName = "山田太郎";  // ← ユーザー名を入れる仕組みに置き換え

    function startQuiz() {
      score = 0;
      currentIndex = 0;
      wrongListArray = [];
      startTime = Date.now();
      document.getElementById("start").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      showQuestion();
    }

    function showQuestion() {
      if (currentIndex >= quizData.length) {
        showResult();
        return;
      }
      const q = quizData[currentIndex];
      let html = "<p>" + (currentIndex+1) + ". " + q.q + "</p>";
      q.choices.forEach(choice => {
        html += `<button onclick="checkAnswer('${choice}')">${choice}</button><br>`;
      });
      document.getElementById("quiz").innerHTML = html;
    }

    function checkAnswer(choice) {
      const q = quizData[currentIndex];
      if (choice === q.a) {
        score++;
      } else {
        wrongListArray.push(q.q);
      }
      currentIndex++;
      showQuestion();
    }

    function showResult() {
      const endTime = Date.now();
      const timeTaken = Math.floor((endTime - startTime)/1000); // 秒
      document.getElementById("quiz").style.display = "none";
      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML =
        `<p>得点: ${score} / ${quizData.length}</p>
         <p>正答率: ${(score/quizData.length*100).toFixed(1)}%</p>
         <p>時間: ${timeTaken} 秒</p>`;

      // === ここから Google スプレッドシート送信処理 ===
      const result = {
        userId: currentUserId,
        userName: currentUserName,
        score: score,
        total: quizData.length,
        correctRate: score / quizData.length,
        duration: timeTaken,
        wrongWords: wrongListArray
      };

      fetch("https://script.google.com/a/macros/tseminar.co.jp/s/AKfycby42p75gpx1jyBIfiHU11oDfSBMs2pWzwpaigv__8SVv_mfx2La3LF6fCkM3fq-KV97ag/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(result)
      })
      .then(res => res.json())
      .then(resp => console.log("送信成功:", resp))
      .catch(err => console.error("送信失敗:", err));
      // === 送信処理ここまで ===
    }
  </script>
</body>
</html>
